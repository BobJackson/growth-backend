# 阶段1：极简运行时 (Boot 4.0 推荐)
FROM cgr.dev/chainguard/wolfi-base:latest
RUN apk add --no-cache ca-certificates

# 复制原生可执行文件 (需与 bootJar.archiveFileName 一致)
COPY build/native/nativeCompile/app /app

# 默认环境变量
ENV SPRING_PROFILES_ACTIVE=prod

# 非 root 用户 (Chainguard 镜像默认已是非 root)
ENTRYPOINT ["/app"]

# CMD 定义默认参数，可被运行时覆盖
CMD ["--spring.profiles.active=${SPRING_PROFILES_ACTIVE}"]